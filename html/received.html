<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Received Data</title>

    <link rel="stylesheet" href="../css/style.css">
</head>
<body>

    <h1>Received Data</h1>

    <!-- Form -->
     <form id="dataform_2">
        <!-- Received Data to display -->
        <div id="received_data"></div>

        <!-- Add another element and submit to a db -->

        <!-- Buttons to select from -->
        <div class="buttons">
            <button class="type_client" value="employer" id="employer">Employer</button>
            <button class="type_client" value="employee" id="employee">Employee</button>
        </div>

        <!-- Submit Button -->
        <button class="submit" id="submit">Submit</button>
     </form>

    <!-- <script src="../js/data_to.js"></script> -->

    <script>
        console.log("The Data To page");

        // Get URL Parameters (it's a search)
        const urlParams = new URLSearchParams(window.location.search);

        // Retrieve and decode parameters

        // First initial
        const user_first = urlParams.get('first') ? 
            decodeURIComponent(urlParams.get('first')) : 'N/A';
        // Last Name
        const user_last = urlParams.get('last') ?
            decodeURIComponent(urlParams.get('last')) : 'N/A';
        // Pin Number
        const user_pin = urlParams.get('pin') ?
            decodeURIComponent(urlParams.get('pin')) : 'N/A';

        // Display received data

        // first query the div to display data in
        const dataDisplay = document.getElementById('received_data');

        // concatenate the first init and last name
        // let result = text1.concat(text2);

        let userName = user_first.concat(user_last);
        // console.log(userName);

        // set the inner HTML in the data display div
        dataDisplay.innerHTML = `
            <p>User: ${userName}</p>
            <p>Pin: ${user_pin}</p>`
        ;

        // Client type buttons

        // First add event listener to the button selections

        // Query through both buttons to grab the selected value
        let acct_type_buttons = document.querySelectorAll('.type_client');

        // Iterate through both and add event listeners
        acct_type_buttons.forEach(acct_type_button => {
            // add event listener to acct type button
            acct_type_button.addEventListener('click', (e) => {
                // Prevent reset of page
                e.preventDefault();
                // For each button in div remove the 'selected' class
                acct_type_buttons.forEach(btn => btn.classList.remove('selected'));
                // add the 'selected' css class to the selected button
                acct_type_button.classList.add('selected');
                // // store the selected value in a variable
                // const selectedValue = acct_type_button.value;
                // console.log(selectedValue, 'Is the selected button');
                // return selectedValue;
                // Create a function for the button value to be global
                function getValue() {
                    // store the selected value in a variable
                    const selectedValue = acct_type_button.value;
                    // console.log(selectedValue, 'Is the selected button');
                    return selectedValue;
                }
                // Extract the selected button to here
                const globalSelectedValue = getValue();
                console.log('Global Selected Value: ', globalSelectedValue);
            });
        });

        /*
            For Each to Global Example

            let globalValue;

            array.forEach(item => {
                globalValue = item; // Modifies the outer variable
            });

            console.log(globalValue); // Accessible here

        **/

        // Submit Button function
            // in it send:

        // add event listener to form through submit button
        // let submit_button = document.getElementById('submit');

        let dataform_2 = document.getElementById('dataform_2');
        
        dataform_2.addEventListener('submit', (e) => {
            // Prevent reset of page
            e.preventDefault();
            
            // above values to database
                // Test Print

                // The User Name
                console.log(userName);

                // The Pin Number
                console.log(user_pin);

                // The Selected User Type button
                // console.log(globalSelectedValue);
        });

    </script>
    
</body>
</html>